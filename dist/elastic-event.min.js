!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.ElasticEvent=e():t.ElasticEvent=e()}(this,function(){return function(t){function e(i){if(n[i])return n[i].exports;var o=n[i]={exports:{},id:i,loaded:!1};return t[i].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e){function n(){this.host="localhost:9200",this.index=null,this.type=null,this.queue=[],this.max=256,this.traits={},this.interval=1e4,this.intervalSend=null,this.beforeunload=null}n.prototype.xhr=function(t,e,n,i){var o=new XMLHttpRequest;return"function"==typeof i&&(o.ontimeout=o.onerror=o.onload=function(){var t=null;(!o.status||o.status>=400)&&(t=new Error(o.statusText||"request failed")),i(t,o.responseText?JSON.parse(o.responseText):null,o.status,o)}),o.open("POST",t,!n),e?(o.setRequestHeader("Content-Type","text/plain"),o.send(e)):o.send(null),o},n.prototype.send=function(t,e){var n=t||{};this.queue.length&&(n.op="bulk",this.request(this.queue.splice(0,n.max||this.max).join(""),n,e))},n.prototype.request=function(t,e,n){var i,o=e||{},r=o.url||o.host||this.host;return o.url||((o.index||this.index)&&(r+="/"+(o.index||this.index)),(o.type||this.type)&&(r+="/"+(o.type||this.type)),r+="/_"+(o.op||"search")),t&&"object"==typeof t&&(i=JSON.stringify(t)),this.xhr(r,i||t,o.sync,n)},n.prototype.add=function(t,e){var n,i=e||{},o={_index:i.index||this.index,_type:i.type||this.type};if("object"!=typeof t)throw new Error("log event is not an object");i.id&&(o._id=i.id),n=JSON.stringify({index:o})+"\n"+JSON.stringify(t)+"\n",this.queue.push(n),this.queue.length>this.max&&this.send()},n.prototype.baseEvent=function(t){var e,n=t||{};for(e in this.traits)this.traits.hasOwnProperty(e)&&!n.hasOwnProperty(e)&&(n[e]=this.traits[e]);return n},n.prototype.track=function(t,e){if("string"!=typeof t)throw new Error("invalid type");this.add(this.baseEvent(e),{type:t})},n.prototype.identify=function(t){var e;for(e in t)t.hasOwnProperty(e)&&(this.traits[e]=t[e])},n.prototype.search=function(t,e,n){var i=e||{};i.op="search",this.request(t,i,n)},n.prototype.setupIntervalSend=function(t){var e=t||{};if(this.intervalSend)throw new Error("already setup intervalSend");this.interval=e.interval||this.interval,this.intervalSend=setInterval(this.send.bind(this,null,null),this.interval)},n.prototype.setupBeforeUnload=function(){if(this.beforeunload)throw new Error("already setup beforeUnload");this.beforeunload=this.send.bind(this,{sync:!0},null),window.addEventListener("beforeunload",this.beforeunload)},n.prototype.setup=function(t){this.setupIntervalSend(t),this.setupBeforeUnload()},n.prototype.close=function(t){this.intervalSend&&(clearInterval(this.intervalSend),this.intervalSend=null),this.beforeunload&&(window.removeEventListener("beforeunload",this.beforeunload),this.beforeunload=null),self.send(null,t)},t.exports=n}])});
//# sourceMappingURL=elastic-event.min.js.map