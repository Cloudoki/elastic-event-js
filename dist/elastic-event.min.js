!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.ElasticEvent=e():t.ElasticEvent=e()}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e){function n(t){var e=t||{};return this instanceof n?(this.host=e.host||"localhost:9200",this.index=e.index,this.type=e.type,this.queue=[],this.max=e.max||256,this.traits={},this.interval=e.interval||1e4,this.intervalSend=null,this.beforeunload=null,e.setupIntervalSend&&this.setupIntervalSend(),void(e.setupBeforeUnload&&this.setupBeforeUnload())):new n(e)}n.prototype.xhr=function(t,e,n,r){var i=new XMLHttpRequest;return"function"==typeof r&&(i.ontimeout=i.onerror=i.onload=function(){var t=null;(!i.status||i.status>=400)&&(t=new Error(i.statusText||"request failed")),r(t,i.responseText?JSON.parse(i.responseText):null,i.status,i)}),i.open("POST",t,!n),e?(i.setRequestHeader("Content-Type","text/plain"),i.send(e)):i.send(null),this},n.prototype.request=function(t,e,n){var r,i=e||{},s=i.url||i.host||this.host;return i.url||((i.index||this.index)&&(s+="/"+(i.index||this.index)),(i.type||this.type)&&(s+="/"+(i.type||this.type)),s+="/_"+(i.op||"search")),t&&"object"==typeof t&&(r=JSON.stringify(t)),this.xhr(s,r||t,i.sync,n),this},n.prototype.send=function(t,e){var n=t||{};return this.queue.length?(n.op="bulk",this.request(this.queue.splice(0,n.max||this.max).join(""),n,e),this):this},n.prototype.add=function(t,e){var n,r=e||{},i={_index:r.index||this.index,_type:r.type||this.type};if("object"!=typeof t)throw new Error("log event is not an object");return r.id&&(i._id=r.id),n=JSON.stringify({index:i})+"\n"+JSON.stringify(t)+"\n",this.queue.push(n),this.queue.length>this.max&&this.send(),this},n.prototype.baseEvent=function(t){var e,n=t||{};for(e in this.traits)this.traits.hasOwnProperty(e)&&!n.hasOwnProperty(e)&&(n[e]=this.traits[e]);return n},n.prototype.track=function(t,e){if("string"!=typeof t)throw new Error("invalid type");return this.add(this.baseEvent(e),{type:t})},n.prototype.identify=function(t){var e;for(e in t)t.hasOwnProperty(e)&&(this.traits[e]=t[e]);return this},n.prototype.search=function(t,e,n){var r=e||{};return r.op="search",this.request(t,r,n),this},n.prototype.setupIntervalSend=function(t){if(this.intervalSend)throw new Error("already setup intervalSend");return this.interval=t||this.interval,this.intervalSend=setInterval(this.send.bind(this,null,null),this.interval),this},n.prototype.setupBeforeUnload=function(){if(this.beforeunload)throw new Error("already setup beforeUnload");return this.beforeunload=this.send.bind(this,{sync:!0},null),window.addEventListener("beforeunload",this.beforeunload),this},n.prototype.close=function(t,e){return this.intervalSend&&(clearInterval(this.intervalSend),this.intervalSend=null),this.beforeunload&&(window.removeEventListener("beforeunload",this.beforeunload),this.beforeunload=null),self.send(t,e),this},t.exports=n}])});
//# sourceMappingURL=elastic-event.min.js.map